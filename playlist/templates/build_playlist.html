{% extends 'base.html' %}
{% block content %}
    {% load static %}

    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <a>Create A Track To Add To Playlist</a>
                <form method='POST'>
                    {% csrf_token %}
                    {{ form.as_p }}
                    <input type='submit' value='Save'/>
                </form>
            </div>

            <div class="col-sm-4">
                <form role="search" id="search">
                    <div class="form-group">
                        <input type="text" value="drone" placeholder="Search by Tag" class="form-control" name="search">
                    </div>
                    <button class="btn btn-default" type="submit">Search</button>
                </form>
            </div>

            <div class="col-sm-4">
                <form method='POST'>
                    {% csrf_token %}

                    <input type='submit' value='Save'/>
                    <div class="panel panel-default">
                        <div class="panel-heading">Search Results</div>
                        <table id="results" class="table table-striped table-hover">
                            <thead>
                            <tr>
                                <th>Tag</th>
                                <th>Most Playlisted Track</th>
                            </tr>

                            </thead>
                            <tbody>
                            </tbody>

                        </table>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            function showTrack(released) {
                document.getElementById("player").src = "https://stream.resonate.coop/embed/track/" + released;
                document.getElementById("listen").href = "https://stream.resonate.coop/track/" + released;
                var form = document.getElementById('form')
                form.addEventListener('submit', function (event) {
                    event.preventDefault()
                    var title = document.getElementById('title').value
                })
            }

            function search() {
                const query = $("#search").find("input[name=search]").val();
                $.get("/search?q=" + encodeURIComponent(query),
                    function (data) {
                        const t = $("table#results tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (track) {
                            $("<tr><td class='track'>" + track.title + "</td><td>" + track.tagline + "</td></tr>"
                            ).appendTo(t)
                                .click(function () {
                                    showTrack(track.released);
                                })
                        });
                        showTrack(data[0].released);
                    }, "json");
                return false;
            }

            $("#search").submit(search);
            search();
        })
    </script>
{% endblock %}
